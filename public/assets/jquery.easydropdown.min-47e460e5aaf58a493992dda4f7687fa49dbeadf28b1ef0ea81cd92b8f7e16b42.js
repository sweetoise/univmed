!function(e){function t(){this.isField=!0,this.keyboardMode=this.hasLabel=this.cutOff=this.disabled=this.inFocus=this.down=!1,this.nativeTouch=!0,this.wrapperClass="dropdown",this.onChange=null}t.prototype={constructor:t,instances:{},init:function(t,s){var o=this;e.extend(o,s),o.$select=e(t),o.id=t.id,o.options=[],o.$options=o.$select.find("option"),o.isTouch="ontouchend"in document,o.$select.removeClass(o.wrapperClass+" dropdown"),o.$select.is(":disabled")&&(o.disabled=!0),o.$options.length&&(o.$options.each(function(t){var s=e(this);s.is(":selected")&&(o.selected={index:t,title:s.text()},o.focusIndex=t),s.hasClass("label")&&0==t?(o.hasLabel=!0,o.label=s.text(),s.attr("value","")):o.options.push({domNode:s[0],title:s.text(),value:s.val(),selected:s.is(":selected")})}),o.selected||(o.selected={index:0,title:o.$options.eq(0).text()},o.focusIndex=0),o.render())},render:function(){var t=this;t.$container=t.$select.wrap('<div class="'+t.wrapperClass+(t.isTouch&&t.nativeTouch?" touch":"")+(t.disabled?" disabled":"")+'"><span class="old"/></div>').parent().parent(),t.$active=e('<span class="selected">'+t.selected.title+"</span>").appendTo(t.$container),t.$carat=e('<span class="carat"/>').appendTo(t.$container),t.$scrollWrapper=e("<div><ul/></div>").appendTo(t.$container),t.$dropDown=t.$scrollWrapper.find("ul"),t.$form=t.$container.closest("form"),e.each(t.options,function(){t.$dropDown.append("<li"+(this.selected?' class="active"':"")+">"+this.title+"</li>")}),t.$items=t.$dropDown.find("li"),t.cutOff&&t.$items.length>t.cutOff&&t.$container.addClass("scrollable"),t.getMaxHeight(),t.isTouch&&t.nativeTouch?t.bindTouchHandlers():t.bindHandlers()},getMaxHeight:function(){for(i=this.maxHeight=0;i<this.$items.length;i++){var e=this.$items.eq(i);if(this.maxHeight+=e.outerHeight(),this.cutOff==i+1)break}},bindTouchHandlers:function(){var t=this;t.$container.on("click.easyDropDown",function(){t.$select.focus()}),t.$select.on({change:function(){var s=e(this).find("option:selected"),o=s.text(),s=s.val();t.$active.text(o),"function"==typeof t.onChange&&t.onChange.call(t.$select[0],{title:o,value:s})},focus:function(){t.$container.addClass("focus")},blur:function(){t.$container.removeClass("focus")}})},bindHandlers:function(){var t=this;t.query="",t.$container.on({"click.easyDropDown":function(){t.down||t.disabled?t.close():t.open()},"mousemove.easyDropDown":function(){t.keyboardMode&&(t.keyboardMode=!1)}}),e("body").on("click.easyDropDown."+t.id,function(s){s=e(s.target);var o=t.wrapperClass.split(" ").join(".");!s.closest("."+o).length&&t.down&&t.close()}),t.$items.on({"click.easyDropDown":function(){var s=e(this).index();t.select(s),t.$select.focus()},"mouseover.easyDropDown":function(){if(!t.keyboardMode){var s=e(this);s.addClass("focus").siblings().removeClass("focus"),t.focusIndex=s.index()}},"mouseout.easyDropDown":function(){t.keyboardMode||e(this).removeClass("focus")}}),t.$select.on({"focus.easyDropDown":function(){t.$container.addClass("focus"),t.inFocus=!0},"blur.easyDropDown":function(){t.$container.removeClass("focus"),t.inFocus=!1},"keydown.easyDropDown":function(e){if(t.inFocus){t.keyboardMode=!0;var s=e.keyCode;if(38!=s&&40!=s&&32!=s||(e.preventDefault(),38==s?(t.focusIndex--,t.focusIndex=0>t.focusIndex?t.$items.length-1:t.focusIndex):40==s&&(t.focusIndex++,t.focusIndex=t.focusIndex>t.$items.length-1?0:t.focusIndex),t.down||t.open(),t.$items.removeClass("focus").eq(t.focusIndex).addClass("focus"),t.cutOff&&t.scrollToView(),t.query=""),t.down)if(9==s||27==s)t.close();else{if(13==s)return e.preventDefault(),t.select(t.focusIndex),t.close(),!1;if(8==s)return e.preventDefault(),t.query=t.query.slice(0,-1),t.search(),clearTimeout(t.resetQuery),!1;38!=s&&40!=s&&(e=String.fromCharCode(s),t.query+=e,t.search(),clearTimeout(t.resetQuery))}}},"keyup.easyDropDown":function(){t.resetQuery=setTimeout(function(){t.query=""},1200)}}),t.$dropDown.on("scroll.easyDropDown",function(){t.$dropDown[0].scrollTop>=t.$dropDown[0].scrollHeight-t.maxHeight?t.$container.addClass("bottom"):t.$container.removeClass("bottom")}),t.$form.length&&t.$form.on("reset.easyDropDown",function(){t.$active.text(t.hasLabel?t.label:t.options[0].title)})},unbindHandlers:function(){this.$container.add(this.$select).add(this.$items).add(this.$form).add(this.$dropDown).off(".easyDropDown"),e("body").off("."+this.id)},open:function(){var e=window.scrollY||document.documentElement.scrollTop,t=window.scrollX||document.documentElement.scrollLeft,s=this.notInViewport(e);this.closeAll(),this.getMaxHeight(),this.$select.focus(),window.scrollTo(t,e+s),this.$container.addClass("open"),this.$scrollWrapper.css("height",this.maxHeight+"px"),this.down=!0},close:function(){this.$container.removeClass("open"),this.$scrollWrapper.css("height","0px"),this.focusIndex=this.selected.index,this.query="",this.down=!1},closeAll:function(){var e,t=Object.getPrototypeOf(this).instances;for(e in t)t[e].close()},select:function(e){"string"==typeof e&&(e=this.$select.find("option[value="+e+"]").index()-1);var t=this.options[e],s=this.hasLabel?e+1:e;this.$items.removeClass("active").eq(e).addClass("active"),this.$active.text(t.title),this.$select.find("option").removeAttr("selected").eq(s).prop("selected",!0).parent().trigger("change"),this.selected={index:e,title:t.title},this.focusIndex=i,"function"==typeof this.onChange&&this.onChange.call(this.$select[0],{title:t.title,value:t.value})},search:function(){var e=this,t=function(t){e.focusIndex=t,e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.scrollToView()};for(i=0;i<e.options.length;i++){var s=e.options[i].title.toUpperCase();if(0==s.indexOf(e.query))return void t(i)}for(i=0;i<e.options.length;i++)if(s=e.options[i].title.toUpperCase(),-1<s.indexOf(e.query)){t(i);break}},scrollToView:function(){if(this.focusIndex>=this.cutOff){var e=this.$items.eq(this.focusIndex).outerHeight()*(this.focusIndex+1)-this.maxHeight;this.$dropDown.scrollTop(e)}},notInViewport:function(e){var t=e+(window.innerHeight||document.documentElement.clientHeight),s=this.$dropDown.offset().top+this.maxHeight;return s>=e&&s<=t?0:s-t+5},destroy:function(){this.unbindHandlers(),this.$select.unwrap().siblings().remove(),this.$select.unwrap(),delete Object.getPrototypeOf(this).instances[this.$select[0].id]},disable:function(){this.disabled=!0,this.$container.addClass("disabled"),this.$select.attr("disabled",!0),this.down||this.close()},enable:function(){this.disabled=!1,this.$container.removeClass("disabled"),this.$select.attr("disabled",!1)}};var s=function(e,s){e.id=e.id?e.id:"EasyDropDown"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase();var o=new t;o.instances[e.id]||(o.instances[e.id]=o,o.init(e,s))};e.fn.easyDropDown=function(){var e,o=arguments,n=[];return e=this.each(function(){if(o&&"string"==typeof o[0]){var e=t.prototype.instances[this.id][o[0]](o[1],o[2]);e&&n.push(e)}else s(this,o[0])}),n.length?1<n.length?n:n[0]:e},e(function(){"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(e){return e.__proto__}:function(e){return e.constructor.prototype}),e("select.dropdown").each(function(){var t=e(this).attr("data-settings");settings=t?e.parseJSON(t):{},s(this,settings)})})}(jQuery);